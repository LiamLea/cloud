# etcd

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->
<!-- code_chunk_output -->

- [etcd](#etcd)
    - [概述](#概述)
      - [1.etcd特点](#1etcd特点)
      - [2.与redis比较](#2与redis比较)
    - [基于etcd的服务发现](#基于etcd的服务发现)
      - [1.概述](#1概述)

<!-- /code_chunk_output -->

### 概述

#### 1.etcd特点
* 数据格式：key-value
* 存储方式：磁盘
* 有版本控制
  * 当修改数据会生成新的版本，原先的数据不会被覆盖或删除
  * 这样容器导致数据量增加，所以会有一个压缩的操作，压缩之后，之前版本的数据就会被删除
  * 每一次原子操作，都会增加一个版本（即所有数据形成一个新的版本）
* 监视数据

#### 2.与redis比较
* redis
  * 数据存储在内存中，持久化可以存储到磁盘
  * 可用于数据库、缓存、消息代理
  * 支持更强多的数据类型
* etcd
  * 数据存储在磁盘中，保证了数据的可靠性
  * 更强的容错机制

* 所以，redis更适合用于缓存，etcd更适合用于用作数据库，存储配置信息

***

### 基于etcd的服务发现

#### 1.概述
![](./imgs/etcd_01.png)

* 服务注册
同一service的所有节点注册到相同目录下（即在etcd中存储有统一前缀的key）
* 健康检查
利用lease，如果节点是健康的，会不停的更新key的lease
* 服务发现
watch某一个key，当该key添加、删除、修改，都会收到通知
