# overview

[toc]

### 概述

#### 1. AS（autonomous system）
* 一个网络的集合（一般一个自治系统中的ip都有统一的前缀）
* 自治系统内 可以决定该自治系统 采用什么路由协议
* 自治系统间 通过BGP协议进行连接
* 一个 自治系统 会分配一个全局的唯一的16位号码，ASN（autonomous system number）

#### 2.IGP（interior gateway protocol，内部网关协议）
用于 **同一个自治系统内** 的 路由 交换路由信息 的协议

##### （1）常用IGP
* ospf
* rip
* iBGP（因为路由条目太多，光靠原先的IGP协议无法满足，所以需要iBGP）

#### 3.EGP（exterior gateway protocol，外部网关协议）
用于 **不同自治系统内** 的邻居路由 交换路由信息 的协议

##### （1）常用EGP
* BGP

#### 4.IGP和EGP
这里IGP协议是iBGP，EGP协议是eBGP（即是EGP）
![](./imgs/overview_01.jpg)

#### 5.广播

##### （1）广播分类
* 全网广播
  * ip：255.255.255.255
* 子网广播
  * 比如：3.1.5.255，就会在3.1.5.0/24这个网段内进行广播

##### （2）原理
* 构建广播报文
  * layer-3：目标地址设为广播地址
  * layer-2：目标mac，`FF:FF:FF:FF:FF:FF`
* 在当前广播域发送广播报文
  * **当前广播域**指的是**在同一个广播域**，**不是指同一个网段**
  * 广播包不能被路由
* 目标机器收到数据包
  * 先检查mac地址，如果mac地址为`FF:FF:FF:FF:FF:FF`，会接收该数据包
  * 然后检查ip地址，如果ip地址不符合要求就会丢弃
    * 比如：目标ip为`3.1.6.255`，如果这台机器不在`3.1.6.0/24`这个网段，就会丢弃该广播包

#### 6.组播（多播）

##### （1）原理
* 构建组播报文
  * layer-3：目标地址设为组播ip地址（比如：224.0.0.1）
  * layer-2：目标mac地址，根据组播ip地址生成
    * mac地址中有一个标志位，标识该包是单播还是组播
    * mac地址前25位固定，后23位利用组播ip地址生成
* 在当前广播域发送组播包
  * **当前广播域**指的是**在同一个广播域**，**不是指同一个网段**
  * 路由器收到组播包后，根据组播地址，决定是否路由组播包
* 目标机器收到数据包
  * 先检查mac地址
  * 然后检查ip地址

##### （2）特点
* 组播地址用的D类地址（`224.0.0.0 - 239.255.255.255`）
* `224.0.0.0/24`这个范围的组播地址不能被路由，即只会在当前网卡所在的广播域中（不是指 同一个网段）

##### （3）常用组播地址
* `224.0.0.1` —— 广播域内（不是网段内）的所有主机
* `224.0.0.2` —— 广播域内（不是网段内）的所有路由器

##### （4）使用
* 主机选择是否将 相应网卡 加入 指定组播组
  * `ip maddr show`能够查看网卡所在的组播组

##### （5）示例
* `ping -I <interface> 224.0.0.1`
  * ping网卡所在广播域内的所有机器（如果不指定网卡，使用默认网卡）
  * 需要其他机器开启回复：`echo 0 > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts`

#### 7.anycast（选播）

给**多个server**配置**相同的** **公网ip**

##### (1) 原理
在不同的AS中，可以给server配置相同的public ip，
不同的AS通过BGP协议交换路由，当客户端需要访问该public ip时，
会计算出一个最有的路由，即只会达到最近的一个server

##### (2) 作用
* 减轻DDoS攻击
  * 如果有多个网站有多个位于不同位置的服务器提供服务（比如：CDN），DDoS利用botnet网络，如果这些机器位于不同的AS中，会分散到多个不同位置的服务器上，从而减轻某一台服务器的压力
* 实现CDN，路由到最最近的缓存服务器
