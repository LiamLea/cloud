input {
  file {
    type => "system" 
    path => "/var/log/system.log*"
    start_position => beginning
    sincedb_path => "/opt/logstash/sincedb_path/system_log_process"
    ignore_older => 604800
    add_field => {"sysid"=>"system"}
    close_older => 3600
  }
  file {
    type => "nginx_access"
    path => "/var/log/access.log*"
    start_position => beginning
    sincedb_path => "/opt/logstash/sincedb_path/nginx_access_log_process"
    ignore_older => 604800
    add_field => {"sysid"=>"access"}
    close_older => 3600
  }
  file {
    type => "nginx_err"
    path => "/var/log/error.log*"
    start_position => beginning
    sincedb_path => "/opt/logstash/sincedb_path/nginx_error_log_process"
    ignore_older => 6048000
    add_field => {"sysid"=>"error"}
    close_older => 3600
  }
  file {
    type => "kangpaas"
    path => "/usr/local/kangpaas/log/kangpaas.websocket*.log"
    start_position => beginning
    codec=>multiline{
                pattern => "\s*"
                negate => true
                what => "previous"
        }
    sincedb_path => "/opt/logstash/sincedb_path/kangpaas_websocket_log_process"
    ignore_older => 604800
    add_field => {"sysid"=>"websocket"}
    close_older => 3600
  }
  file {
    type => "kangpaas"
    path => "/usr/local/kangpaas/log/kangpaas.eureka*.log"
    start_position => beginning
    codec=>multiline{
                pattern => "\s*"
                negate => true
                what => "previous"
        }
    sincedb_path => "/opt/logstash/sincedb_path/kangpaas_eureka_log_process"
    ignore_older => 604800
    add_field => {"sysid"=>"eureka"}
    close_older => 3600
  }
  file {
    type => "kangpaas"
    path => "/usr/local/kangpaas/log/kangpaas.gate*.log"
    start_position => beginning
    codec=>multiline{
                pattern => "\s*"
                negate => true
                what => "previous"
        }
    sincedb_path => "/opt/logstash/sincedb_path/kangpaas_gate_log_process"
    ignore_older => 604800
    add_field => {"sysid"=>"gate"}
    close_older => 3600
  }
  file {
    type => "weblogic_access"
    path => "/var/log/weblogic_access.log"
    start_position => beginning
    sincedb_path => "/opt/logstash/sincedb_path/weblogic_access_log_process"
    ignore_older => 604800
    add_field => {"sysid"=>"access"}
    close_older => 3600
  }
  file {
    type => "weblogic_admin"
    path => "/var/log/weblogic_admin.log"
    start_position => beginning
    codec=>multiline{
                pattern => "^####"
                negate => true
                what => "previous"
        }
    sincedb_path => "/opt/logstash/sincedb_path/weblogic_admin_log_process"
    ignore_older => 604800
    add_field => {"sysid"=>"admin"}
    close_older => 3600
  }
  file {
    type => "weblogic_basic"
    path => "/var/log/weblogic_basic.log"
    start_position => beginning
    codec=>multiline{
                pattern => "^####"
                negate => true
                what => "previous"
        }
    sincedb_path => "/opt/logstash/sincedb_path/weblogic_basic_log_process"
    ignore_older => 604800
    add_field => {"sysid"=>"basic"}
    close_older => 3600
  }
}
filter{
     if [type] == "system" {
        grok{
            match => {"message" => "%{SYSLOGTIMESTAMP:logtime}\s%{HOSTNAME:hostname}\s%{GREEDYDATA:message}"}
            overwrite => ["message"]                    
        }
    }else if [type] == "nginx_access" {
        grok{
          match => {"message" => "%{IP:clientip}\s-\s-\s\[%{HTTPDATE:request_time}\]\s\"%{WORD:http_method}\s%{URIPATH:request}\sHTTP/%{NUMBER:httpversion}\"\s%{INT:status}\s%{INT:size}\s\"%{URI:request_host}\"\s\"%{GREEDYDATA:user_agent}\"\s%{QS:other}"}
          overwrite => ["message"]
          }
    }else if [type] == "nginx_err" {
         grok{
          match => {"message" => "(?<logtime>%{YEAR}[./-]%{MONTHNUM}[./-]%{MONTHDAY}[- ]%{TIME})\s\[%{LOGLEVEL:severity}\]\s%{POSINT:pid}#%{NUMBER:tid}:\s%{GREEDYDATA:message}"}
          overwrite => ["message"]    
          }
    }else if [type] == "kangpaas" { 
        grok{
           match => {"message" => "%{TIMESTAMP_ISO8601:logtime}\s\[%{GREEDYDATA:thread}\]\s%{LOGLEVEL:level}\s%{GREEDYDATA:message}"}
           overwrite => ["message"]
        }
    }else if [type] == "weblogic_access" {
       grok{
        match => {"message" => "%{IP:host}\s-\s%{WORD:weblogic}\s\[%{HTTPDATE:access_time}\]\s\"%{WORD:method}\s%{URIPATH:request}\sHTTP/%{NUMBER:http_version}\"\s%{INT:status}\s%{INT:size}"}
        overwrite => ["message"]
        }
    }else if [type] == "weblogic_admin" { 
        grok{
          match => {"message" => "####<%{GREEDYDATA:logtime}>\s<%{LOGLEVEL:level}>\s<%{WORD:system}>\s<%{WORD:name}>\s<%{WORD:sys_name}>\s<%{NOTSPACE:timer}>\s<(?<kind>([<]?[\w+|\s]*[>]?))>\s<>\s<(?<uuid>([A-Fa-f0-9]{8}-(?:[A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}-[A-Fa-f0-9]{8}))>\s<%{POSINT:time_stamp}>\s<\[severity-value:\s%{INT:severity-value}\]\s\[rid:\s%{NOTSPACE:rid}\]\s\[partition-id:\s%{INT:partition-id}\]\s\[partition-name:\s%{WORD:partition-name}\]\s>\s<(?<bea>(\b\w+\b-(?:[+-]?(?:[0-9]+))))>\s<%{GREEDYDATA:message}>"}
          overwrite => ["message"]
        }
    }else if [type] == "weblogic_basic" {
         grok{
           match => {"message" => "####<%{GREEDYDATA:logtime}>\s<%{LOGLEVEL:level}>\s<(?<sys_type>([\w+|\s|.]+))>\s<%{NOTSPACE:system}>\s<%{NOTSPACE:server}>\s<(?<thread>([^<]*))>\s<(?<kind>([<]?[\w+|\s]*[>]?))>\s<>\s<(?<uuid>([A-Fa-f0-9]{8}-(?:[A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}-[A-Fa-f0-9]{8}))>\s<%{POSINT:sys_timestamp}>\s<\[severity-value:\s%{INT:severity-value}\]\s\[rid:\s%{NOTSPACE:rid}\]\s\[partition-id:\s%{INT:partition-id}\]\s\[partition-name:\s%{WORD:partition-name}\]\s>\s<(?<bea>(\b\w+\b-(?:[+-]?(?:[0-9]+))))>\s<%{GREEDYDATA:message}>"}
           overwrite => ["message"]
         }
        date {
         locale => "en_US"
         match => ["logtime", "MMM dd, yyyy K:mm:ss,SSS aa z"]
         timezone => "Asia/Shanghai"
         target => "@timestamp"
        }
       }
}
output {
    if [type] == "system" {
            elasticsearch {
                    hosts => "3.1.4.240:19200"
                    index => "logstash-system"
            }       
   }else if [type] == "nginx_access" {
                elasticsearch {
                    hosts => "3.1.4.240:19200"
                    index => "logstash-nginx"
            }
   }else if [type] == "nginx_err" {
                elasticsearch {
                    hosts => "3.1.4.240:19200"
                    index => "logstash-nginx"
            }   
   }else if [type] == "weblogic_access"{
            elasticsearch {
                    hosts => "3.1.4.240:19200"
                    index => "logstash-weblogic"
            }
   }else if [type] == "weblogic_admin" {
            elasticsearch {
                    hosts => "3.1.4.240:19200"
                    index => "logstash-weblogic"
            }
   }else if [type] == "weblogic_basic" {
            elasticsearch {
                    hosts => "3.1.4.240:19200"
                    index => "weblogic-log"
            }    
   }else if [sysid] == "websocket" {
            elasticsearch {
                    hosts => "3.1.4.240:19200"
                    index => "logstash-kangpaas"
            }
   }else if [sysid] == "eureka" {
            elasticsearch {
                    hosts => "3.1.4.240:19200"
                    index => "logstash-kangpaas"
            }
   }else if [sysid] == "gate" {
            elasticsearch {
                    hosts => "3.1.4.240:19200"
                    index => "logstash-kangpaas"
            }
   }
}
